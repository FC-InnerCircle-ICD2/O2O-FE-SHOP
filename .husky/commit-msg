COMMIT_MESSAGE_FILE=$1
COMMIT_MESSAGE=$(cat "$COMMIT_MESSAGE_FILE")

# PR Merge Commit ì²˜ë¦¬ í•¨ìˆ˜
process_pr_merge() {
  PR_NUMBER=$(echo "$COMMIT_MESSAGE" | grep -oE "#[0-9]+")
  PR_TITLE=$(echo "$COMMIT_MESSAGE" | sed -nE 's/^Merge pull request #[0-9]+ from [^:]+:?[[:space:]]*(.*)/\1/p')
  echo "ðŸ”€ Merge $PR_NUMBER: $PR_TITLE"
}

# Gitmoji ë§¤í•‘ ì²˜ë¦¬ í•¨ìˆ˜
process_gitmoji() {
  # ìž…ë ¥ íƒ€ìž…ì„ ì²« ê¸€ìžë§Œ ëŒ€ë¬¸ìžë¡œ, ë‚˜ë¨¸ì§€ëŠ” ì†Œë¬¸ìžë¡œ ë³€í™˜
  FORMATTED_TYPE=$(echo "$1" | awk '{print toupper(substr($0, 1, 1)) tolower(substr($0, 2))}')
  
  case "$FORMATTED_TYPE" in
    Feat)    echo "âœ¨ $FORMATTED_TYPE: $(echo "$COMMIT_MESSAGE" | cut -d':' -f2-)" ;;
    Design)  echo "ðŸŽ¨ $FORMATTED_TYPE: $(echo "$COMMIT_MESSAGE" | cut -d':' -f2-)" ;;
    Refactor) echo "â™»ï¸ $FORMATTED_TYPE: $(echo "$COMMIT_MESSAGE" | cut -d':' -f2-)" ;;
    Fix)     echo "ðŸ› $FORMATTED_TYPE: $(echo "$COMMIT_MESSAGE" | cut -d':' -f2-)" ;;
    *)       >&2 echo "âŒ ì»¤ë°‹ ë©”ì‹œì§€ëŠ” ë‹¤ìŒ í˜•ì‹ì„ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤:"
             >&2 echo "   Feat: ê¸°ëŠ¥"
             >&2 echo "   Design: ë””ìžì¸/ë¬¸ì„œ ìˆ˜ì •"
             >&2 echo "   Refactor: ë¦¬íŒ©í† ë§"
             >&2 echo "   Fix: ë²„ê·¸ ìˆ˜ì •"
             exit 1 ;;
  esac
}

# PR Merge Commitì¸ ê²½ìš° ì²˜ë¦¬
if echo "$COMMIT_MESSAGE" | grep -qE "^Merge pull request"; then
  NEW_MESSAGE=$(process_pr_merge)
else
  # Gitmoji ë§¤í•‘ ì²˜ë¦¬
  COMMIT_TYPE=$(echo "$COMMIT_MESSAGE" | cut -d':' -f1)
  NEW_MESSAGE=$(process_gitmoji "$COMMIT_TYPE")
fi

# ì»¤ë°‹ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
echo "$NEW_MESSAGE" > "$COMMIT_MESSAGE_FILE"
